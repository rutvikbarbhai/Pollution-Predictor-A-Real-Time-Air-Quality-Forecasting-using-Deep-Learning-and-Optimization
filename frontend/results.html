<!DOCTYPE html>
<html>
<head>
  <title>Pollution Data Visualization</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
    }
    h2 {
      color: #007BFF;
    }
    #data-table {
      margin-top: 20px;
      border-collapse: collapse;
      width: 100%;
    }
    #data-table th, #data-table td {
      border: 1px solid #ccc;
      padding: 8px;
    }
    #data-table th {
      background-color: #f0f0f0;
    }
    canvas {
      margin-top: 40px;
    }
  </style>
</head>
<body>

  <h2>Pollution Data Visualizer (PM2.5, PM10, AQI)</h2>

  <input type="file" id="csvFile" accept=".csv" />
  <br><br>
  <table id="data-table"></table>

  <canvas id="pollutionChart" width="900" height="400"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    const fileInput = document.getElementById('csvFile');
    const table = document.getElementById('data-table');
    const ctx = document.getElementById('pollutionChart').getContext('2d');
    let chart;

    fileInput.addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (!file) return;

      Papa.parse(file, {
        header: true,
        skipEmptyLines: true,
        complete: function (results) {
          const data = results.data;
          if (!data.length) return;

          // Clear table
          table.innerHTML = "";

          // Display table header
          const headerRow = document.createElement('tr');
          Object.keys(data[0]).forEach(key => {
            const th = document.createElement('th');
            th.textContent = key;
            headerRow.appendChild(th);
          });
          table.appendChild(headerRow);

          // Display table data
          data.forEach(row => {
            const tr = document.createElement('tr');
            Object.values(row).forEach(value => {
              const td = document.createElement('td');
              td.textContent = value;
              tr.appendChild(td);
            });
            table.appendChild(tr);
          });

          // Extract data for plotting
          const labels = data.map((_, i) => i + 1);
          const pm25 = data.map(d => parseFloat(d.pm25_value));
          const pm10 = data.map(d => parseFloat(d.pm10_value));
          const aqi = data.map(d => parseFloat(d.AQI));

          // Destroy previous chart if it exists
          if (chart) chart.destroy();

          // Create Chart
          chart = new Chart(ctx, {
            type: 'line',
            data: {
              labels,
              datasets: [
                {
                  label: 'PM2.5',
                  data: pm25,
                  borderColor: 'rgba(255, 99, 132, 1)',
                  fill: false
                },
                {
                  label: 'PM10',
                  data: pm10,
                  borderColor: 'rgba(54, 162, 235, 1)',
                  fill: false
                },
                {
                  label: 'AQI',
                  data: aqi,
                  borderColor: 'rgba(75, 192, 192, 1)',
                  fill: false
                }
              ]
            },
            options: {
              responsive: true,
              plugins: {
                title: {
                  display: true,
                  text: 'Actual Pollution Values (PM2.5, PM10, AQI)'
                }
              },
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });
        }
      });
    });
  </script>

</body>
</html>
